<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>thread module</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h1 id="thread-module"><a class="header-link" href="#thread-module"></a>thread module</h1>
<p>This module contains functions for running Lua functions into native threads. 
Unlike Lua coroutines, native threads are scheluded by the operating system, 
allowing to run operations in real time.</p>
<h2 id="thread-start-function-"><a class="header-link" href="#thread-start-function-"></a>thread.start(function)</h2>
<p>Start a new thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>function: function to execute in the thread.</li>
</ul>
<p>Returns: thread identifier. You must store this identifier into a variable for
further operations with it.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Function to execute</span>
f1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> led_pin = pio.PB_4
    pio.pin.setdir(pio.OUTPUT, led_pin)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">do</span>
    pio.pin.sethigh(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    pio.pin.setlow(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Start thread</span>
th1 = thread.start(f1)</code></pre><h2 id="thread-suspend-thread-id-"><a class="header-link" href="#thread-suspend-thread-id-"></a>thread.suspend([thread id])</h2>
<p>Suspend all threads or a specific thread. This function suspends the execution
of the underline operating system thread remaining in memory until it&#39;s resumed 
or stopped.</p>
<p>Arguments:</p>
<ul class="list">
<li>thread id: this argument it&#39;s optional. If not present function suspend all
threads, and if present suspend the specified thread.</li>
</ul>
<p>Returns: nothing.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Function to execute</span>
f1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> led_pin = pio.PB_4
    pio.pin.setdir(pio.OUTPUT, led_pin)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">do</span>
    pio.pin.sethigh(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    pio.pin.setlow(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Start thread</span>
th1 = thread.start(f1)

....

<span class="hljs-comment">-- Suspend thread</span>
thread.suspend(th1)</code></pre><h2 id="thread-resume-thread-id-"><a class="header-link" href="#thread-resume-thread-id-"></a>thread.resume([thread id])</h2>
<p>Resume all threads or a specific thread. This function resume the execution
of the underline operating system thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>thread id: this argument it&#39;s optional. If not present function resume all
threads, and if present resume the specified thread.</li>
</ul>
<p>Returns: nothing.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Function to execute</span>
f1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> led_pin = pio.PB_4
    pio.pin.setdir(pio.OUTPUT, led_pin)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">do</span>
    pio.pin.sethigh(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    pio.pin.setlow(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Start thread</span>
th1 = thread.start(f1)

....

<span class="hljs-comment">-- Suspend thread</span>
thread.suspend(th1)

....

<span class="hljs-comment">-- Resume thread</span>
thread.resume(th1)</code></pre><h2 id="thread-stop-thread-id-"><a class="header-link" href="#thread-stop-thread-id-"></a>thread.stop([thread id])</h2>
<p>Stop all threads or a specific thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>thread id: this argument it&#39;s optional. If not present function stop all
threads, and if present stop the specified thread. This function stop the 
execution of the underline operating system thread and removes it from memory.</li>
</ul>
<p>Returns: nothing.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Function to execute</span>
f1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> led_pin = pio.PB_4
    pio.pin.setdir(pio.OUTPUT, led_pin)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">do</span>
    pio.pin.sethigh(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    pio.pin.setlow(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Start thread</span>
th1 = thread.start(f1)

....

<span class="hljs-comment">-- Stop thread</span>
thread.stop(th1)</code></pre><h2 id="thread-status-thread-id-"><a class="header-link" href="#thread-status-thread-id-"></a>thread.status(thread id)</h2>
<p>Get the status of a specific thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>thread id: thread identifier.</li>
</ul>
<p>Returns: thread status (running, suspended or nil).</p>
<pre class="hljs"><code><span class="hljs-comment">-- Function to execute</span>
f1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    <span class="hljs-keyword">local</span> led_pin = pio.PB_4
    pio.pin.setdir(pio.OUTPUT, led_pin)

    <span class="hljs-keyword">while</span> <span class="hljs-keyword">true</span> <span class="hljs-keyword">do</span>
    pio.pin.sethigh(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    pio.pin.setlow(led_pin)
    tmr.delayms(<span class="hljs-number">250</span>)
    <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- Start thread</span>
th1 = thread.start(f1)

....

<span class="hljs-comment">-- Suspend thread</span>
thread.suspend(th1)

<span class="hljs-comment">-- Get thread status</span>
thread.status(th1)

&gt; suspended</code></pre><h2 id="thread-sleep-seconds-"><a class="header-link" href="#thread-sleep-seconds-"></a>thread.sleep(seconds)</h2>
<p>Sleep current thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>seconds: seconds to sleep.</li>
</ul>
<p>Returns: nothing.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Sleep for 4 seconds</span>
thread.sleep(<span class="hljs-number">4</span>)</code></pre><h2 id="thread-usleep-useconds-"><a class="header-link" href="#thread-usleep-useconds-"></a>thread.usleep(useconds)</h2>
<p>Sleep current thread.</p>
<p>Arguments:</p>
<ul class="list">
<li>useconds: micro seconds to sleep.</li>
</ul>
<p>Returns: nothing.</p>
<pre class="hljs"><code><span class="hljs-comment">-- Sleep for 500000 micro seconds (0,5 seconds)</span>
thread.usleep(<span class="hljs-number">500000</span>)</code></pre>    </article>
  </body>
</html>
